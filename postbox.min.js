!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){var t=document.createElement("a");return t.href=e,t.origin||t.protocol+"//"+t.hostname}function r(e,t){var n="function"==typeof e[t]?e[t]():e[t];return Promise.resolve(n)}function a(e,t){return e.origin!==t}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s="message",d=function(){function e(t){var i=this;n(this,e),this.parent=t.parent,this.child=t.child,this.childOrigin=t.childOrigin,this.frame=t.frame,this.listener=function(e){if(!a(e,i.childOrigin)&&"emit"===e.data.type){var t=e.data,n=t.name,r=t.data;n in i.events&&i.events[n].call(i,r)}},this.parent.addEventListener(s,this.listener,!1)}return o(e,[{key:"get",value:function(e){var t=this;return new Promise(function(n,i){var r=function e(i){"reply"===i.data.type&&(t.parent.removeEventListener(s,e,!1),n(i.data.value))};t.parent.addEventListener(s,r,!1),t.child.postMessage({type:"request",property:e},t.childOrigin)})}},{key:"call",value:function(e,t){this.child.postMessage({type:"call",property:e,data:t},this.childOrigin)}},{key:"on",value:function(e,t){this.events[e]=t}},{key:"destroy",value:function(){this.parent.removeEventListener(s,this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}]),e}(),c=function(){function e(t){var i=this;n(this,e),this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child.addEventListener(s,function(e){a(e,i.parentOrigin)||("call"===e.data.type?property in i.model&&"function"==typeof i.model[property]&&i.model[property].call(i,data):"request"===e.data.type&&r(i.model,e.data.prototype).then(function(t){e.source.postMessage({type:"reply",value:t},e.origin)}))},!1)}return o(e,[{key:"emit",value:function(e,t){this.parent.postMessage({type:"emit",value:{name:e,data:t}},this.parentOrigin)}}]),e}(),l=function(){function e(t){return n(this,e),this.child=window,this.parent=this.child.parent,this.model=t,this.sendHandshakeReply()}return o(e,[{key:"sendHandshakeReply",value:function(){var e=this;return new Promise(function(t,n){var i=function i(r){"handshake"===r.data.type?(e.child.removeEventListener(s,i,!1),e.parentOrigin=r.origin,r.source.postMessage({type:"handshake-reply"},r.origin),Object.assign(e.model,r.data.model),t(new c(e))):n("Handshake reply failed.")};e.child.addEventListener(s,i,!1)})}}]),e}(),u=function(){function e(t){n(this,e);var i=t.container,r=t.url,a=t.model;return this.parent=window,this.frame=document.createElement("iframe")(i||document.body).appendChild(this.frame),this.child=this.frame.contentWindow||this.frame.contentDocument.parentWindow,this.model=a||{},this.sendHandshake(r)}return o(e,[{key:"sendHandshake",value:function(e){var t=this,n=i(e);return new Promise(function(i,r){var a=function e(n){"handshake-reply"===n.data.type?(t.parent.removeEventListener(s,e,!1),t.childOrigin=n.origin,i(new d(t))):r("Handshake failed")};t.parent.addEventListener(s,a,!1);var o=function(e){t.child.postMessage({type:"handshake",model:t.model},n)};t.frame.onload=o,t.frame.src=e})}}]),e}();u.Client=l,t.default=u}])});